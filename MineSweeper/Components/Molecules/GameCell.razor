@* Molecule: GameCell - Individual game cell with state *@

<button @onclick="OnClick"
        @oncontextmenu="OnRightClick"
        @oncontextmenu:preventDefault="true"
        @ondblclick="OnDoubleClick"
        class="cell-button @GetCellClass()"
        disabled="@Disabled"
        id="cell-@Row-@Col">
    <span class="@(IsFlagged && !IsRevealed ? "flag-animation" : "")">
        @GetCellContent()
    </span>
</button>

<style>
    .cell-button {
        border-radius: 0.25rem;
        transition: transform 100ms ease-out;
        transform: scale(1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.875rem;
        width: 1.75rem;
        height: 1.75rem;
        will-change: transform;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
    }

    @@media (min-width: 768px) {
        .cell-button {
            font-size: 1rem;
            width: 2rem;
            height: 2rem;
        }
    }

    .cell-button:not(:disabled):hover {
        transform: scale(1.1);
    }

    .cell-unrevealed {
        background: linear-gradient(to bottom right, #4b5563, #374151);
        border: 2px solid #6b7280;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    }

    .cell-unrevealed:not(:disabled):hover {
        background: linear-gradient(to bottom right, #6b7280, #4b5563);
    }

    .cell-mine {
        background: linear-gradient(to bottom right, #dc2626, #b91c1c);
        border: 2px solid #991b1b;
        animation: mine-reveal 0.5s ease-out;
    }

    @@keyframes mine-reveal {
        0% {
            transform: scale(0) rotate(180deg);
        }
        50% {
            transform: scale(1.2) rotate(90deg);
        }
        100% {
            transform: scale(1) rotate(0deg);
        }
    }

    .cell-revealed {
        background-color: #1f2937;
        border: 1px solid #374151;
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        animation: cell-reveal 0.15s ease-out;
    }

    @@keyframes cell-reveal {
        0% {
            transform: scale(0.95);
            opacity: 0.7;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .flag-animation {
        animation: flag-place 0.3s ease-out;
    }

    @@keyframes flag-place {
        0% {
            transform: scale(0) rotate(-180deg);
        }
        50% {
            transform: scale(1.2) rotate(-90deg);
        }
        100% {
            transform: scale(1) rotate(0deg);
        }
    }

    /* Number colors */
    .mine-count-1 { color: #60a5fa; }
    .mine-count-2 { color: #34d399; }
    .mine-count-3 { color: #f87171; }
    .mine-count-4 { color: #a78bfa; }
    .mine-count-5 { color: #fbbf24; }
    .mine-count-6 { color: #f472b6; }
    .mine-count-7 { color: #d1d5db; }
    .mine-count-8 { color: #f3f4f6; }

    @@media (max-width: 640px) {
        .cell-button {
            width: 1.5rem;
            height: 1.5rem;
            font-size: 0.75rem;
        }
    }
</style>

@code {
    [Parameter] public int Row { get; set; }
    [Parameter] public int Col { get; set; }
    [Parameter] public bool IsRevealed { get; set; }
    [Parameter] public bool IsFlagged { get; set; }
    [Parameter] public bool IsMine { get; set; }
    [Parameter] public int AdjacentMines { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }
    [Parameter] public EventCallback<MouseEventArgs> OnRightClick { get; set; }
    [Parameter] public EventCallback OnDoubleClick { get; set; }

    private string GetCellClass()
    {
        if (!IsRevealed)
        {
            return "cell-unrevealed";
        }

        if (IsMine)
        {
            return "cell-mine";
        }

        var numberClass = AdjacentMines > 0 ? $" mine-count-{AdjacentMines}" : "";
        return $"cell-revealed{numberClass}";
    }

    private string GetCellContent()
    {
        if (!IsRevealed && IsFlagged)
        {
            return "ðŸš©";
        }

        if (!IsRevealed)
        {
            return "";
        }

        if (IsMine)
        {
            return "ðŸ’£";
        }

        return AdjacentMines > 0 ? AdjacentMines.ToString() : "";
    }
}
