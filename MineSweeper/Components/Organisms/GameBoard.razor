@using MineSweeper.Services
@inject GameService GameService
@inject SoundService SoundService
@inject IJSRuntime JsRuntime
@implements IDisposable

@if (GameService.CurrentGame != null)
{
    <div class="relative">
        <div class="overflow-auto max-h-[70vh] rounded-xl shadow-2xl">
            <div class="game-board"
                 style="--grid-columns: @GameService.CurrentGame.Columns;">
                @for (int row = 0; row < GameService.CurrentGame.Rows; row++)
                {
                    @for (int col = 0; col < GameService.CurrentGame.Columns; col++)
                    {
                        var r = row;
                        var c = col;
                        var cell = GameService.CurrentGame.Board[r, c];

                        <GameCell @key="@(r * GameService.CurrentGame.Columns + c)"
                                  Row="r"
                                  Col="c"
                                  IsRevealed="cell.IsRevealed"
                                  IsFlagged="cell.IsFlagged"
                                  IsMine="cell.IsMine"
                                  AdjacentMines="cell.AdjacentMines"
                                  Disabled="@(GameService.CurrentGame.Status != GameStatus.InProgress && GameService.CurrentGame.Status != GameStatus.NotStarted)"
                                  OnClick="(e) => HandleCellClick(r, c, e)"
                                  OnRightClick="(e) => HandleRightClick(r, c, e)"
                                  OnDoubleClick="() => HandleDoubleClick(r, c)" />
                    }
                }
            </div>
        </div>

        @if (GameService.CurrentGame != null &&
             GameService.CurrentGame.CreatedAt == _currentGameCreatedAt &&
             (GameService.CurrentGame.Status == GameStatus.Won || GameService.CurrentGame.Status == GameStatus.Lost))
        {
            <div class="game-over-overlay">
                <div class="game-over-content">
                    @if (GameService.CurrentGame.Status == GameStatus.Won)
                    {
                        <div class="animate-bounce">
                            <p class="text-4xl font-bold text-green-400 mb-2">Victory! ðŸŽ‰</p>
                            <p class="text-xl text-white">Time: @FormatTime(GameService.CurrentGame.ElapsedTime)</p>
                            <p class="text-sm text-gray-400 mt-2">You found all mines!</p>
                        </div>
                    }
                    else
                    {
                        <div class="animate-pulse">
                            <p class="text-4xl font-bold text-red-400 mb-2">Game Over ðŸ’¥</p>
                            <p class="text-lg text-white">Better luck next time!</p>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
}